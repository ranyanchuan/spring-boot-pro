<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.yyan.dao.UserDao">    <!--批量插入用户数据 todo 添加默认角色-->    <insert id="insertListUser">        insert into user(id, name,password,status,email,create_time,update_time) values        <foreach collection="list" item="user" separator=",">            (uuid(), #{user.name},#{user.password},#{user.status},#{user.email}, now(), now())        </foreach>    </insert>    <!--批量查询用户 todo 带上用户权限-->    <!--查询条件-->    <sql id="selectListUserCondition">        <if test="id != null">            and u.id= #{id}        </if>        <if test="email != null">            and u.email=#{email}        </if>        <if test="status != null">            and u.status=#{status}        </if>        <if test="name != null">            and u.title like '%${name}%'        </if>    </sql>    <!--分页查询数据-->    <select id="selectListUser" resultType="com.yyan.pojo.User">        SELECT *,        create_time as createTime,        update_time as updateTime        FROM user        WHERE 1=1        <include refid="selectListUserCondition"/>        limit ${pageIndex*size},${(pageIndex+1)*size}    </select>    <!--查询分页总条数-->    <select id="countListUser" parameterType="java.util.HashMap" resultType="java.lang.Integer">        select count(id) from user WHERE 1=1        <include refid="selectListUserCondition"/>    </select>    <!--批量修改用户-->    <update id="updateListUser" parameterType="java.util.List">        <foreach collection="list" item="item" index="index" open="" close="" separator=";">            update user            <set>                <if test="item.name!=null and item.name!=''">name=#{item.name},</if>                <if test="item.password!=null and item.password!=''">password=#{item.password},</if>                <if test="item.status!=null and item.status!=''">status=#{item.status},</if>                <if test="item.email!=null and item.email!=''">email=#{item.email},</if>                update_time=now()            </set>            where 1=1 and id = #{item.id}        </foreach>    </update>    <!--批量删除 要删除角色 todo 级联删除角色用户表-->    <!--添加用户-->    <insert id="insertUser" parameterType="com.yyan.pojo.User">        insert into user(id, name,password,status,email,create_time,update_time)            values(#{id}, #{name},#{password},#{status},#{email},#{createTime},#{updateTime})    </insert>    <!--查询 通过用户 id 的关联用户角色表-->    <resultMap type="com.yyan.pojo.User" id="getUserRoleMap">        <id property="id" column="id"/>        <result property="name" column="name"/>        <result property="email" column="email"/>        <result property="createTime" column="createTime"/>        <result property="updateTime" column="updateTime"/>        <collection property="role" ofType="java.util.HashMap" column="list">            <id property="id" column="roleId"/>            <result property="title" column="title"/>        </collection>    </resultMap>    <select id="queryUserRoleList" resultMap="getUserRoleMap">        SELECT        u.id as id,        u.name as name,        u.email as email,        u.create_time as createTime,        u.update_time as updateTime,        r.id as roleId,        r.title as title        FROM (select * from user where 1=1 limit ${pageIndex*size},${(pageIndex+1)*size}) u        LEFT JOIN user_role ur        ON u.id = ur.user_id        LEFT JOIN role r        ON ur.role_id = r.id        WHERE 1=1        <if test="id != null">            and u.id= #{id}        </if>        <if test="email != null">            and u.email=#{email}        </if>        <if test="status != null">            and u.status=#{status}        </if>        <if test="name != null">            and u.title like '%${name}%'        </if>    </select>    <!--获取总条数-->    <!--查询所有用户-->    <select id="getAllUser" resultType="com.yyan.pojo.User">        select        id,        name,        status,        email,        create_time as createTime,        update_time as updateTime from user WHERE 1=1        <if test="id != null">            and id= #{id}        </if>        <if test="email != null">            and email=#{email}        </if>        <if test="status != null">            and status=#{status}        </if>        <if test="name != null">            and title like '%${name}%'        </if>        limit ${pageIndex*size},${(pageIndex+1)*size};    </select>    <!--查询分页总条数-->    <select id="selectCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">        select count(id) from user WHERE 1=1        <if test="id != null">            and id= #{id}        </if>        <if test="email != null">            and email=#{email}        </if>        <if test="status != null">            and status=#{status}        </if>        <if test="name != null">            and title like '%${name}%'        </if>    </select>    <!--查询所有用户-->    <select id="getUserById" resultType="com.yyan.pojo.User">      select        id,        name,        status,        email,        password,        create_time as createTime,        update_time as updateTime        from user where id=#{id};    </select>    <!-- 更新用户-->    <update id="updateUser" parameterType="com.yyan.pojo.User">        update user set name=#{name},status=#{status},email=#{email},update_time=#{updateTime}  where id=#{id};    </update>    <!-- 更新用户密码-->    <update id="updateUserPass" parameterType="com.yyan.pojo.User">        update user set name=#{name},passwrod=#{passwrod},update_time=#{updateTime}  where id=#{id};    </update>    <!-- 删除用户-->    <delete id="deleteUser" parameterType="com.yyan.pojo.User">        delete from user where id=#{id};    </delete></mapper>